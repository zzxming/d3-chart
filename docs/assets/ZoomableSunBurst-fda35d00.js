import{_ as O}from"./LoadingTip.vue_vue_type_script_setup_true_lang-748e4402.js";import{a as V}from"./axios-4a70c6fc.js";import{d as D}from"./index-677af89f.js";import{f as H,i as L}from"./init-880e203b.js";import{o as W}from"./ordinal-2364f02c.js";import{i as q}from"./rainbow-202fb553.js";import{d as F,p as G}from"./arc-99452674.js";import{c as J}from"./create-029c038a.js";import{h as K}from"./dice-70a649c2.js";import{d as Q,r as h,o as U,n as X,c as Y,b as tt,u as S,e as et,f as at,_ as rt}from"./index-194efed9.js";import"./path-53f90ab3.js";function nt($,u){for(var m=new Array(u),c=0;c<u;++c)m[c]=$(c/(u-1));return m}const ot=Q({__name:"ZoomableSunBurst",setup($){function u(o){return"children"in o}let m=h(),c=h(!0),B=h(!1),g=h(),_=h(!0),T=H(",d"),b=h(D().attr("class","d3_tip").html((o,i)=>`
			            <strong>${i.data.name}<strong>
			            <span>${T(i.value||0)}</span>
			        `)),I=async()=>{let o=await new Promise(async(i,n)=>{i((await V.get("/d3json/ZoomableSunburst.json")).data)}).catch(i=>{console.log(i),B.value=!0});c.value=!1,o&&(g.value=o)};return U(async()=>{if(await X(),await I(),!g.value)return;const{innerWidth:o,innerHeight:i}=window;let n=o/10,N=W(nt(q,g.value.children.length+1)),j=F().startAngle(a=>a.x0).endAngle(a=>a.x1).padAngle(a=>Math.min((a.x1-a.x0)/2,.005)).padRadius(n*1.5).innerRadius(a=>a.y0*n).outerRadius(a=>Math.max(a.y0*n,a.y1*n-1));const p=(a=>{let f=0;const s=K(a).sum(l=>(u(l)||(f+=1),u(l)?0:l.value)).sort((l,d)=>(d.value??0)-(l.value??0));return f!==1&&(_.value=!1),G().size([2*Math.PI,s.height+1])(s)})(g.value);p.each(a=>a.current=a);const k=J("svg").attr("viewBox",[0,0,o,i]),y=k.append("g").attr("transform",`translate(${o/2},${i/2})`);y.call(b.value);{let a=function(t){return t.y1<=3&&t.y0>=1&&t.x1>t.x0},f=function(t,r){x.datum(r||p),x.select("foreignObject").text(e=>e.data.name),p.each(e=>e.target={x0:Math.max(0,Math.min(1,(e.x0-r.x0)/(r.x1-r.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(e.x1-r.x0)/(r.x1-r.x0)))*2*Math.PI,y0:Math.max(0,e.y0-r.depth),y1:Math.max(0,e.y1-r.depth)});const v=y.transition().duration(750);s.attr("visibility",e=>a(e.target)?"visible":"hidden"),z.transition(v).tween("data",e=>{const M=L(e.current,e.target);return E=>e.current=M(E)}).filter(function(e){return!!(Number(this.getAttribute("fill-opacity"))||a(e.target))}).attr("fill-opacity",e=>a(e.target)?e.children?.6:.4:0).attr("pointer-events",e=>a(e.target)?"auto":"none").attrTween("d",e=>()=>j(e.current)),C.filter(function(e){return!!(Number(this.getAttribute("opacity"))||w(e.target))}).transition(v).attr("opacity",e=>w(e.target)).attrTween("transform",e=>()=>R(e.current))},s=y.selectAll("g").data(p.descendants().slice(1)).join("g"),l=20,d=8,A=(Number(_.value)+1)*n,P=()=>A-d*2,w=t=>+(t.y1<=3&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.08),Z=t=>`
					font-size: ${.5**t.depth*8+10}px;
					text-overflow: ellipsis;
					white-space: nowrap;
					user-select: none;
					text-align: center;
				`,R=t=>{const r=(t.x0+t.x1)/2*180/Math.PI,v=(t.y0+t.y1+Number(_.value))/2*n;let e=r<180?-1:1;return`rotate(${r-90}) translate(${v+e*A/2+-e*d}, 0) rotate(${r<180?0:180})`};s.on("mouseover",b.value.show).on("mouseout",b.value.hide).attr("visibility",t=>a(t)?"visible":"hidden");let z=s.append("path").attr("fill",t=>{let r=t;for(;r.depth>1;)r=r.parent;return N(r.data.name)}).attr("fill-opacity",t=>a(t)?t.children?.6:.4:0).attr("pointer-events",t=>a(t)?"auto":"none").attr("d",t=>j(t)),C=s.append("foreignObject").attr("width",P).attr("height",l).attr("y",-l/2).attr("opacity",w).attr("style",Z).attr("transform",R).text(t=>t.data.name),x=y.append("g").datum(p).attr("style","cursor: pointer;");x.append("circle").attr("r",n).attr("fill","none").attr("pointer-events","all"),x.append("foreignObject").attr("width",n*2-d*2).attr("height",l).attr("x",-n+d).attr("y",-l/2).attr("style",t=>"text-align: center; text-overflow: ellipsis; white-space: nowrap;").text(t=>t.data.name),s.filter(t=>!!t.children).style("cursor","pointer").on("click",(t,r)=>{f(t,r)}),x.on("click",(t,r)=>{f(t,r.parent||p)})}m.value.appendChild(k.node())}),(o,i)=>{const n=O;return et(),Y(n,{loading:S(c),loadError:S(B)},{default:tt(()=>[at("div",{ref_key:"chart",ref:m,class:"chart_box"},null,512)]),_:1},8,["loading","loadError"])}}});const yt=rt(ot,[["__scopeId","data-v-627d560a"]]);export{yt as default};
