import{l as nt,_ as at}from"./LoadingTip.vue_vue_type_script_setup_true_lang-1ea9d305.js";import{S as rt}from"./Scrubber-97b7b1e0.js";import{a as O}from"./index-c73def89.js";import{t as W,r as it,h as Z}from"./dice-70a649c2.js";import{r as ot}from"./accessors-409bcfe1.js";import{c as ut}from"./colors-98f238a0.js";import{g as lt}from"./group-1ad2545a.js";import{d as st,r as I,o as ct,n as ft,c as dt,b as pt,u as z,e as mt,p as ht,g as gt,f as vt,_ as yt}from"./index-d0139ac4.js";import{r as P}from"./range-6bc2a9a0.js";import{m as _t}from"./max-adfc8a60.js";import{c as bt}from"./create-f9d26a3e.js";import{f as Ct,i as At}from"./init-6640a802.js";import{o as Tt}from"./ordinal-41f09803.js";function Rt(a,c){let u=0;if(c===void 0)for(let r of a)(r=+r)&&(u+=r);else{let r=-1;for(let d of a)(d=+c(d,++r,a))&&(u+=d)}return u}const wt=a=>+a;var H={},M={},D=34,S=10,V=13;function Y(a){return new Function("d","return {"+a.map(function(c,u){return JSON.stringify(c)+": d["+u+'] || ""'}).join(",")+"}")}function Et(a,c){var u=Y(a);return function(r,d){return c(u(r),d,a)}}function Q(a){var c=Object.create(null),u=[];return a.forEach(function(r){for(var d in r)d in c||u.push(c[d]=d)}),u}function T(a,c){var u=a+"",r=u.length;return r<c?new Array(c-r+1).join(0)+u:u}function jt(a){return a<0?"-"+T(-a,6):a>9999?"+"+T(a,6):T(a,4)}function Bt(a){var c=a.getUTCHours(),u=a.getUTCMinutes(),r=a.getUTCSeconds(),d=a.getUTCMilliseconds();return isNaN(a)?"Invalid Date":jt(a.getUTCFullYear())+"-"+T(a.getUTCMonth()+1,2)+"-"+T(a.getUTCDate(),2)+(d?"T"+T(c,2)+":"+T(u,2)+":"+T(r,2)+"."+T(d,3)+"Z":r?"T"+T(c,2)+":"+T(u,2)+":"+T(r,2)+"Z":u||c?"T"+T(c,2)+":"+T(u,2)+"Z":"")}function J(a){var c=new RegExp('["'+a+`
\r]`),u=a.charCodeAt(0);function r(e,t){var m,p,l=d(e,function(s,h){if(m)return m(s,h-1);p=s,m=t?Et(s,t):Y(s)});return l.columns=p||[],l}function d(e,t){var m=[],p=e.length,l=0,s=0,h,C=p<=0,A=!1;e.charCodeAt(p-1)===S&&--p,e.charCodeAt(p-1)===V&&--p;function j(){if(C)return M;if(A)return A=!1,H;var R,k=l,N;if(e.charCodeAt(k)===D){for(;l++<p&&e.charCodeAt(l)!==D||e.charCodeAt(++l)===D;);return(R=l)>=p?C=!0:(N=e.charCodeAt(l++))===S?A=!0:N===V&&(A=!0,e.charCodeAt(l)===S&&++l),e.slice(k+1,R-1).replace(/""/g,'"')}for(;l<p;){if((N=e.charCodeAt(R=l++))===S)A=!0;else if(N===V)A=!0,e.charCodeAt(l)===S&&++l;else if(N!==u)continue;return e.slice(k,R)}return C=!0,e.slice(k,p)}for(;(h=j())!==M;){for(var w=[];h!==H&&h!==M;)w.push(h),h=j();t&&(w=t(w,s++))==null||m.push(w)}return m}function v(e,t){return e.map(function(m){return t.map(function(p){return o(m[p])}).join(a)})}function g(e,t){return t==null&&(t=Q(e)),[t.map(o).join(a)].concat(v(e,t)).join(`
`)}function y(e,t){return t==null&&(t=Q(e)),v(e,t).join(`
`)}function _(e){return e.map(f).join(`
`)}function f(e){return e.map(o).join(a)}function o(e){return e==null?"":e instanceof Date?Bt(e):c.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:r,parseRows:d,format:g,formatBody:y,formatRows:_,formatRow:f,formatValue:o}}var kt=J(","),Nt=kt.parse,St=J("	"),Ut=St.parse;function U(){return 0}function $(a){return function(){return a}}function X(a,c,u,r,d){for(var v=a.children,g,y=-1,_=v.length,f=a.value&&(d-u)/a.value;++y<_;)g=v[y],g.x0=c,g.x1=r,g.y0=u,g.y1=u+=g.value*f}var G=(1+Math.sqrt(5))/2;function K(a,c,u,r,d,v){for(var g=[],y=c.children,_,f,o=0,e=0,t=y.length,m,p,l=c.value,s,h,C,A,j,w,R;o<t;){m=d-u,p=v-r;do s=y[e++].value;while(!s&&e<t);for(h=C=s,w=Math.max(p/m,m/p)/(l*a),R=s*s*w,j=Math.max(C/R,R/h);e<t;++e){if(s+=f=y[e].value,f<h&&(h=f),f>C&&(C=f),R=s*s*w,A=Math.max(C/R,R/h),A>j){s-=f;break}j=A}g.push(_={value:s,dice:m<p,children:y.slice(o,e)}),_.dice?W(_,u,r,d,l?r+=p*s/l:v):X(_,u,r,l?u+=m*s/l:d,v),l-=s,o=e}return g}const $t=function a(c){function u(r,d,v,g,y){K(c,r,d,v,g,y)}return u.ratio=function(r){return a((r=+r)>1?r:1)},u}(G);function qt(){var a=$t,c=!1,u=1,r=1,d=[0],v=U,g=U,y=U,_=U,f=U;function o(t){return t.x0=t.y0=0,t.x1=u,t.y1=r,t.eachBefore(e),d=[0],c&&t.eachBefore(it),t}function e(t){var m=d[t.depth],p=t.x0+m,l=t.y0+m,s=t.x1-m,h=t.y1-m;s<p&&(p=s=(p+s)/2),h<l&&(l=h=(l+h)/2),t.x0=p,t.y0=l,t.x1=s,t.y1=h,t.children&&(m=d[t.depth+1]=v(t)/2,p+=f(t)-m,l+=g(t)-m,s-=y(t)-m,h-=_(t)-m,s<p&&(p=s=(p+s)/2),h<l&&(l=h=(l+h)/2),a(t,p,l,s,h))}return o.round=function(t){return arguments.length?(c=!!t,o):c},o.size=function(t){return arguments.length?(u=+t[0],r=+t[1],o):[u,r]},o.tile=function(t){return arguments.length?(a=ot(t),o):a},o.padding=function(t){return arguments.length?o.paddingInner(t).paddingOuter(t):o.paddingInner()},o.paddingInner=function(t){return arguments.length?(v=typeof t=="function"?t:$(+t),o):v},o.paddingOuter=function(t){return arguments.length?o.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):o.paddingTop()},o.paddingTop=function(t){return arguments.length?(g=typeof t=="function"?t:$(+t),o):g},o.paddingRight=function(t){return arguments.length?(y=typeof t=="function"?t:$(+t),o):y},o.paddingBottom=function(t){return arguments.length?(_=typeof t=="function"?t:$(+t),o):_},o.paddingLeft=function(t){return arguments.length?(f=typeof t=="function"?t:$(+t),o):f},o}const It=function a(c){function u(r,d,v,g,y){if((_=r._squarify)&&_.ratio===c)for(var _,f,o,e,t=-1,m,p=_.length,l=r.value;++t<p;){for(f=_[t],o=f.children,e=f.value=0,m=o.length;e<m;++e)f.value+=o[e].value;f.dice?W(f,d,v,g,l?v+=(y-v)*f.value/l:y):X(f,d,v,l?d+=(g-d)*f.value/l:g,y),l-=f.value}else r._squarify=_=K(c,r,d,v,g,y),_.ratio=c}return u.ratio=function(r){return a((r=+r)>1?r:1)},u}(G),Mt=ut("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Dt=a=>(ht("data-v-c506d960"),a=a(),gt(),a),Vt=Dt(()=>vt("div",{class:"chart_box"},null,-1)),Lt=st({__name:"AnimatedTreemap",setup(a){let c=I(!0),u=I(!1),r=I(),d=async()=>{const v=P(1790,2e3,10);let g=await Promise.all([O.get("/d3json/animatedTreemap/census-regions.csv"),O.get("/d3json/animatedTreemap/population.tsv")]).then(([e,t])=>{let m=Nt(e.data),l=Ut(t.data).slice(1).map(h=>({name:h[""],values:v.map(C=>Number((h[C]??"").replace(/,/g,"")))}));return[[...m],l]}).catch(e=>{console.log(e),u.value=!0});if(c.value=!1,!g)return;let[y,_]=g;const f=new Map(y.map(e=>[e.State,e.Region])),o=new Map(y.map(e=>[e.State,e.Division]));r.value={keys:v,group:lt(_,e=>f.get(e.name),e=>o.get(e.name))}};return ct(async()=>{var x,F;if(await d(),!r.value)return;await ft();let v=0;function g(n){return y("O-"+(n==null?"":n+"-")+ ++v)}function y(n){return{id:n,href:new URL(`#${n}`,location.href).href+""}}let _=2500,f=r.value,o=rt(P(f.keys.length),{autoplay:!1,delay:_,loop:!1,format:n=>f.keys[n]});const e=document.getElementsByClassName("chart_box")[0];let t=document.getElementsByClassName("observablehq")[0];(x=t==null?void 0:t.parentElement)==null||x.removeChild(t);let m=document.createElement("div");m.classList.add("observablehq"),m.appendChild(o),(F=e.parentElement)==null||F.insertBefore(m,e);let p=f.keys.map((n,i)=>Z(f.group).sum(b=>{let B=b.values;return Array.isArray(B)?B[i]:0}).value??0),l=_t(p)??1;const{innerWidth:s,innerHeight:h}=window,C=qt().tile(It).size([s,h]).padding(n=>n.height===1?1:0).round(!0),A=C(Z(f.group).sum(n=>{let i=n.values;return Array.isArray(i)?Rt(i):0}).sort((n,i)=>(i.value??0)-(n.value??0))),j=bt("svg").attr("viewBox",`0 -20 ${s} ${h+20}`).attr("font-family","sans-serif").attr("font-size",10).style("overflow","visible");let w=Ct(",d");const R=j.append("g").selectAll("g").data(f.keys.map((n,i)=>{const b=A.sum(B=>{let E=B.values;return Array.isArray(E)?E[i]:0}).value??0;return{key:n,value:b,i,k:Math.sqrt(b/l)}}).reverse()).join("g").attr("transform",({k:n})=>`translate(${(1-n)/2*s},${(1-n)/2*h})`).attr("opacity",({i:n})=>n>=o.value?1:0).call(n=>n.append("text").attr("y",-6).attr("fill","#777").selectAll("tspan").data(({key:i,value:b})=>[i,` ${w(b)}`]).join("tspan").attr("font-weight",(i,b)=>b===0?"bold":null).text(i=>i)).call(n=>n.append("rect").attr("fill","none").attr("stroke","#ccc").attr("width",({k:i})=>i*s).attr("height",({k:i})=>i*h)),k=j.append("g").selectAll("g").data(L(o.value)).join("g").attr("transform",n=>`translate(${n.x0},${n.y0})`);let N=Tt(f.group.keys(),Mt.map(n=>nt(n,"white")(.5)));k.append("rect").attr("id",n=>(n.leafUid=g("leaf")).id).attr("fill",n=>{for(;n.depth>1;)n=n.parent;let i=n.data;return Array.isArray(i)?N(i[0]):N("")}).attr("width",n=>n.x1-n.x0).attr("height",n=>n.y1-n.y0),k.append("clipPath").attr("id",n=>(n.clipUid=g("clip")).id).append("use").attr("xlink:href",n=>{var i;return((i=n.leafUid)==null?void 0:i.href)??""}),k.append("text").attr("clip-path",n=>{var i;return`url(${((i=n.clipUid)==null?void 0:i.href)??""})`}).selectAll("tspan").data(n=>[n.data.name,w(n.value??0)]).join("tspan").attr("x",3).attr("y",(n,i,b)=>`${+(i===b.length-1)*.3+1.1+i*.9}em`).attr("fill-opacity",(n,i,b)=>i===b.length-1?.7:null).text(n=>n);function L(n){const i=Math.sqrt((A.sum(E=>{let q=E.values;return Array.isArray(q)?q[n]:0}).value??0)/l),b=(1-i)/2*s,B=(1-i)/2*h;return C.size([s*i,h*i])(A).each(E=>(E.x0+=b,E.x1+=b,E.y0+=B,E.y1+=B)).leaves()}let tt=n=>+n.replace(/,/g,""),et=()=>{let n=o.i.value;R.transition().duration(_).attr("opacity",({i})=>i>=n?1:0),k.data(L(n)).transition().duration(_).ease(wt).attr("transform",i=>`translate(${i.x0},${i.y0})`).call(i=>i.select("rect").attr("width",b=>b.x1-b.x0).attr("height",b=>b.y1-b.y0)).call(i=>i.select("text tspan:last-child").tween("text",function(b){let B=this;const E=At(tt(B.textContent??""),b.value??0);return function(q){B.textContent=w(E(q))}}))};o.addEventListener("input",et),e.appendChild(j.node())}),(v,g)=>{const y=at;return mt(),dt(y,{loading:z(c),loadError:z(u)},{default:pt(()=>[Vt]),_:1},8,["loading","loadError"])}}});const Kt=yt(Lt,[["__scopeId","data-v-c506d960"]]);export{Kt as default};
